/*! angular-breadcrumb - v0.4.0
* http://ncuillery.github.io/angular-breadcrumb
* Copyright (c) 2015 Nicolas Cuillery; Licensed MIT */(function(x,l,y){function q(d){var b=d.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw Error("Invalid state ref '"+d+"'");return{state:b[1],paramExpr:b[3]||null}}function r(d,b,g){return{restrict:"AE",replace:!0,scope:{},template:b.getTemplate({bootstrap2:'\x3cul class\x3d"breadcrumb"\x3e\x3cli ng-repeat\x3d"step in steps" ng-switch\x3d"$last || !!step.abstract" ng-class\x3d"{active: $last}"\x3e\x3ca ng-switch-when\x3d"false" href\x3d"{{step.ncyBreadcrumbLink}}"\x3e{{step.ncyBreadcrumbLabel}}\x3c/a\x3e\x3cspan ng-switch-when\x3d"true"\x3e{{step.ncyBreadcrumbLabel}}\x3c/span\x3e\x3cspan class\x3d"divider" ng-hide\x3d"$last"\x3e/\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e',bootstrap3:'\x3col class\x3d"breadcrumb"\x3e\x3cli ng-repeat\x3d"step in steps" ng-class\x3d"{active: $last}" ng-switch\x3d"$last || !!step.abstract"\x3e\x3ca ng-switch-when\x3d"false" href\x3d"{{step.ncyBreadcrumbLink}}"\x3e{{step.ncyBreadcrumbLabel}}\x3c/a\x3e\x3cspan ng-switch-when\x3d"true"\x3e{{step.ncyBreadcrumbLabel}}\x3c/span\x3e\x3c/li\x3e\x3c/ol\x3e'}),templateUrl:b.getTemplateUrl(),link:{post:function(c){var e=[],h=function(){n(e);e=[];var g=b.$getLastViewScope();c.steps=b.getStatesChain();l.forEach(c.steps,function(a){if(a.ncyBreadcrumb&&a.ncyBreadcrumb.label){var b=d(a.ncyBreadcrumb.label);a.ncyBreadcrumbLabel=b(g);t(e,b,g,a)}else a.ncyBreadcrumbLabel=a.name})};g.$on("$viewContentLoaded",function(){h()});h()}}}}function u(d,b,g){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbLabel}}",compile:function(c,e){var h=c.attr(e.$attr.ncyBreadcrumbLast);h&&c.html(h);return{post:function(e){var a=[],k=function(){n(a);a=[];var k=b.$getLastViewScope(),f=b.getLastStep();f&&(e.ncyBreadcrumbLink=f.ncyBreadcrumbLink,f.ncyBreadcrumb&&f.ncyBreadcrumb.label?(f=d(f.ncyBreadcrumb.label),e.ncyBreadcrumbLabel=f(k),t(a,f,k,e)):e.ncyBreadcrumbLabel=f.name)};g.$on("$viewContentLoaded",function(){k()});k()}}}}}function v(d,b,g){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(c,e){var h=c.attr(e.$attr.ncyBreadcrumbText);h&&c.html(h);var m=c.attr(e.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(a){var k=[],e=function(a,b,k){l.forEach(p(b),function(b){b=k.$watch(b,function(a,b){a!==b&&f()});a.push(b)})},f=function(){n(k);k=[];var f=b.$getLastViewScope(),g=b.getStatesChain(),c=[];l.forEach(g,function(a){a.ncyBreadcrumb&&a.ncyBreadcrumb.label?(a=d(a.ncyBreadcrumb.label),c.push(a(f)),e(k,a,f)):c.push(a.name)});a.ncyBreadcrumbChain=c.join(m)};g.$on("$viewContentLoaded",function(){f()});f()}}}}}function w(d,b,g){return{restrict:"A",scope:{},template:'\x3cspan ng-bind-html\x3d"ncyBreadcrumbChain | trustHtml"\x3e\x3c/span\x3e',compile:function(c,e){var h=c.attr(e.$attr.ncyBreadcrumbHtml);h&&c.html(h);var m=c.attr(e.$attr.ncyBreadcrumbHtmlSeparator)||" / ";return{post:function(a){var k=[],e=function(a,b,k){l.forEach(p(b),function(b){b=k.$watch(b,function(a,b){a!==b&&f()});a.push(b)})},f=function(){n(k);k=[];var f=b.$getLastViewScope(),c=b.getStatesChain(),g=[];l.forEach(c,function(a){a.ncyBreadcrumb&&a.ncyBreadcrumb.label?(a=d(a.ncyBreadcrumb.label),g.push(a(f)),e(k,a,f)):g.push(a.name)});a.ncyBreadcrumbChain=g.join(m)};g.$on("$viewContentLoaded",function(){f()});f()}}}}}var p=function(d){if(d.expressions)return d.expressions;var b=[];l.forEach(d.parts,function(d){l.isFunction(d)&&b.push(d.exp)});return b},t=function(d,b,g,c){l.forEach(p(b),function(e){e=g.$watch(e,function(){c.ncyBreadcrumbLabel=b(g)});d.push(e)})},n=function(d){l.forEach(d,function(b){b()})};r.$inject=["$interpolate","$breadcrumb","$rootScope"];u.$inject=["$interpolate","$breadcrumb","$rootScope"];v.$inject=["$interpolate","$breadcrumb","$rootScope"];w.$inject=["$interpolate","$breadcrumb","$rootScope"];l.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",function(){var d={prefixStateName:null,template:"bootstrap3",templateUrl:null,includeAbstract:!1};this.setOptions=function(b){l.extend(d,b)};this.$get=["$state","$stateParams","$rootScope",function(b,g,c){var e=c;c.$on("$viewContentLoaded",function(a){var b;b=a.targetScope.$id;var d=e.$id;b=l.equals(b.length,d.length)?b>d:b.length>d.length;b&&(e=a.targetScope)});var h=function(a,k){var c,f,h=q(k),l=!1,m=!1;c=0;for(var n=a.length;c<n;c+=1)if(a[c].name===h.state)return;c=b.get(h.state);c.ncyBreadcrumb&&(c.ncyBreadcrumb.force&&(l=!0),c.ncyBreadcrumb.skip&&(m=!0));c["abstract"]&&!d.includeAbstract&&!l||m||(h.paramExpr&&(f=e.$eval(h.paramExpr)),c.ncyBreadcrumbLink=b.href(h.state,f||g||{}),a.unshift(c))},m=function(a){a=q(a);a=b.get(a.state);if(a.ncyBreadcrumb&&a.ncyBreadcrumb.parent){var d="function"===typeof a.ncyBreadcrumb.parent?a.ncyBreadcrumb.parent(e):a.ncyBreadcrumb.parent;if(d)return d}a=a.parent||(/^(.+)\.[^.]+$/.exec(a.name)||[])[1];return"object"===typeof a?a.name:a};return{getTemplate:function(a){return d.templateUrl?null:a[d.template]?a[d.template]:d.template},getTemplateUrl:function(){return d.templateUrl},getStatesChain:function(a){for(var c=[],e=b.$current.self.name;e;e=m(e))if(h(c,e),a&&c.length)return c;d.prefixStateName&&h(c,d.prefixStateName);return c},getLastStep:function(){var a=this.getStatesChain(!0);return a.length?a[0]:void 0},$getLastViewScope:function(){return e}}}]}).directive("ncyBreadcrumb",r).directive("ncyBreadcrumbLast",u).directive("ncyBreadcrumbText",v).directive("ncyBreadcrumbHtml",w).filter("trustHtml",["$sce",function(d){return function(b){return d.trustAsHtml(b)}}])})(window,window.angular);